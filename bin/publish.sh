#!/usr/bin/env bash

set -e

[[ -f "bin/assemble-release.sh" ]] && cd "bin"

#-----------------------------------------------------------------------------------------------------------------------
# Check if we're logged in
#-----------------------------------------------------------------------------------------------------------------------

if ! npm whoami >/dev/null 2>&1; then
    npm login --scope=@david-04
fi

#-----------------------------------------------------------------------------------------------------------------------
# API documentation
#-----------------------------------------------------------------------------------------------------------------------

echo ""
echo "------------------------------------------------------------------------------------------------------------------------"
echo "Publishing the API documentation..."
echo "------------------------------------------------------------------------------------------------------------------------"
echo ""
cd ../docs
git checkout -q docs
git add --all
git commit --amend -m "Update API documentation" --quiet
git push --force origin HEAD
cd ../bin

#-----------------------------------------------------------------------------------------------------------------------
# Packages
#-----------------------------------------------------------------------------------------------------------------------

for BUNDLE in cli web; do
    echo ""
    echo "------------------------------------------------------------------------------------------------------------------------"
    echo "Publishing @david-04/typefinity-${BUNDLE?}..."
    echo "------------------------------------------------------------------------------------------------------------------------"
    echo ""
    cd "../dist/typefinity-${BUNDLE?}"
    npm publish --access=public
    cd "../bin"
done
