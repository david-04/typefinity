#!/usr/bin/env bash

set -e

[[ -f "bin/assemble-release.sh" ]] && cd "bin"

#-----------------------------------------------------------------------------------------------------------------------
# Check if we're logged in
#-----------------------------------------------------------------------------------------------------------------------

if ! npm whoami 2>/dev/null; then
    npm login --scope=@david-04
fi

#-----------------------------------------------------------------------------------------------------------------------
# API documentation
#-----------------------------------------------------------------------------------------------------------------------

echo "Publishing the API documentation..."
cd ../docs
git checkout -q docs
git add --all
git commit --amend -m "Update API documentation"
git push --force origin HEAD
cd ../bin

#-----------------------------------------------------------------------------------------------------------------------
# Packages
#-----------------------------------------------------------------------------------------------------------------------

for BUNDLE in cli web; do
    echo "Publishing ${BUNDLE?}..."
    cd "../dist/${BUNDLE?}"
    npm publish
    cd "../bin"
done
